---
import BaseLayout from '../../layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';
import { isNotDraft, sortByDateDesc } from '../../lib/content';
import FilterBar from '../../components/FilterBar.astro';
import PostCard from '../../components/PostCard.astro';
import { registerFilterList } from '../../lib/filterList';

const posts = (await getCollection('posts')).filter(isNotDraft).sort(sortByDateDesc);

registerFilterList({ inputId: 'posts-filter', itemSelector: '#posts-list [data-filter-text]', emptyId: 'posts-empty' });
---

<BaseLayout title="Posts" description="Thoughts, notes, and write-ups.">
	<h1 class="text-2xl font-semibold tracking-tight">Posts</h1>
	<p class="mt-2 text-sm text-muted-foreground">Thoughts, notes, and write-ups.</p>

	<FilterBar id="posts-filter" placeholder="Filter posts (title, description, tags)â€¦" />

	<div class="mt-6 grid gap-4" id="posts-list">
		{posts.map((post) => (
			<PostCard
				post={post}
				filterText={[post.data.title, post.data.description, ...(post.data.tags ?? [])]
					.filter((v) => typeof v === 'string' && v.length > 0)
					.join(' ')
					.toLowerCase()}
			/>
		))}
	</div>

	<p id="posts-empty" class="mt-6 hidden text-sm text-muted-foreground">No matches.</p>
</BaseLayout>
